<!DOCTYPE html>
<html>
<body>
<canvas id="canvas" style="border:1px solid #000000"></canvas> 


<script>
//------Vars--------
//Canvas Vars
var cwidth=300;
var cheight=300;
var c = document.getElementById("canvas");
var ctx = c.getContext("2d");


//Lemming Vars
var size = 5;
var entx=cwidth/2;
var enty=cheight/2;
var gravity = size;


//Game Vars
var maxPop = 5; 
var currentPop;

var a = new Array(maxPop);
var e = new entrance(entx,enty);
var time = 0;

// GUI
var popDisplay= document.createElement("P");


//Objects
function lemming(id,x,y, direction){
   this.id = id;
   this.x= x;
   this.y= y;
   this.direction = direction;
   this.falling = false;
   this.fallHeight = this.y;


   this.turnAround = function(){
      if (this.direction=="LEFT") this.direction = "RIGHT";
      else this.direction = "LEFT";
   }

   this.move = function(){
      if (this.y <= (cheight-size*2))  this.fall();

      else {
      this.stopFall();
      if (this.direction=="LEFT"){
         this.x--; 
               }
      else if (this.direction=="RIGHT"){
         this.x++;

      }
      if(this.x >= (cwidth-size) || this.x <= size) this.turnAround();

      }

   }
   
   this.fall = function(){
      this.y += gravity; 
      if(!this.falling) {
         this.fallHeight=this.y;
         this.falling = true;
      }
   }

   this.stopFall= function(){
      if (this.falling) {
         this.falling= false;
         if(this.y-this.fallHeight>size*2) this.kill();
      }
   }

   this.kill = function(){
      killLemming(this.id);
   }

   this.draw = function(){
      drawCircle(this.x,this.y,size);
   }

   this.update = function(){
      this.draw();
   }
}

// Entrance
function entrance(x,y){
   var x = x;
   var y = y; 
   var w = size*2;
   var h = size*2;

   this.draw = function(){
       drawRect(x-w/2,y-h/2,w,h);
   }
}

// Init 
function init(){
   canvas.width = cwidth;
   canvas.height = cheight;
   document.body.appendChild(popDisplay); 
   currentPop = 0;
   
}



// --------Functions ----
function drawCircle(x,y,size){
   ctx.beginPath();
   ctx.fillStyle = "#0000FF";
   ctx.arc(x,y,size,0,2*Math.PI);
   ctx.fill();
   ctx.stroke();   
} 


function drawRect(x,y,width, height){
    ctx.fillStyle = "#FF0000";
    ctx.fillRect(x,y,width,height);
    
    ctx.stroke(); 
    
}


function clear(){
   ctx.clearRect(0, 0, cwidth, cheight);
}


function updatePopDisplay(){
   var ctr = 0;
   for(var i =0; i<a.length; i++)
      if (a[i]!=null)ctr++;
   
   currentPop=ctr;
   popDisplay.innerHTML = currentPop;
}

function update(){
   updatePopDisplay();
   clear();

   e.draw();
    for (var i = 0; i < a.length; i++)  
     if (a[i] !=null)a[i].update();
}

function moveLemmings(){
    for (var i = 0; i < a.length; i++)  
       if (a[i] !=null) a[i].move();
}

function spawnLemmings(){
    for (var i = 0; i < a.length; i++)  
       if (time == 100*i +100)
           a[i] = new lemming(i,entx,enty,"RIGHT");
       
}

function killLemming(id){
    a[id]=null;  
}

function gameLoop(){   
   spawnLemmings();

   moveLemmings();

   update();
   time ++; 

}


// ---------MAIN PROGRAM ---------
init();
setInterval(gameLoop, 30);
</script>

</body>
</html> 
